---
title: "Aria2 å®Œæ•´æŒ‡å—ï¼šè½»é‡çº§å¤šåè®®ä¸‹è½½å·¥å…·"
date: 2025-07-28T06:00:00+08:00
categories:
  - æ•ˆç‡å·¥å…·
tags:
  - ä¸‹è½½
  - å·¥å…·
  - å¼€æº
mermaid: true
toc: true
toc_label: "ç›®å½•"
toc_icon: "cog"
---

# Aria2 å®Œæ•´æŒ‡å—ï¼šè½»é‡çº§å¤šåè®®ä¸‹è½½å·¥å…·

## é¡¹ç›®æ¦‚è¿°

[Aria2](https://github.com/aria2/aria2) æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¤šåè®®ã€å¤šæºã€è·¨å¹³å°å‘½ä»¤è¡Œä¸‹è½½å·¥å…·ã€‚å®ƒæ”¯æŒ HTTP/HTTPSã€FTPã€SFTPã€BitTorrent å’Œ Metalink åè®®ï¼Œå…·æœ‰å¼ºå¤§çš„ä¸‹è½½ç®¡ç†åŠŸèƒ½å’Œçµæ´»çš„é…ç½®é€‰é¡¹ã€‚

<div style="text-align: center; margin: 20px 0;">
  <svg width="600" height="300" xmlns="http://www.w3.org/2000/svg">
    <style>
      .title { font-family: Arial; font-size: 24px; font-weight: bold; fill: #2C3E50; text-anchor: middle; }
      .subtitle { font-family: Arial; font-size: 16px; fill: #7F8C8D; text-anchor: middle; }
      .logo { font-family: Arial; font-size: 36px; font-weight: bold; fill: #E74C3C; text-anchor: middle; }
      .highlight { fill: #3498DB; }
      .badge { font-family: Arial; font-size: 12px; fill: #FFFFFF; font-weight: bold; text-anchor: middle; }
      .feature { font-family: Arial; font-size: 14px; fill: #2C3E50; }
    </style>
    <rect width="600" height="300" fill="#ECF0F1" rx="12" ry="12" stroke="#BDC3C7" stroke-width="2"/>
    <text x="300" y="60" class="logo">Aria<tspan class="highlight">2</tspan></text>
    <text x="300" y="90" class="title">å¤šåè®®ä¸‹è½½å·¥å…·</text>
    <text x="300" y="115" class="subtitle">è½»é‡çº§å‘½ä»¤è¡Œä¸‹è½½ç®¡ç†å™¨</text>
    
    <!-- GitHub Stats -->
    <rect x="50" y="140" width="80" height="25" fill="#2ECC71" rx="12" ry="12"/>
    <text x="90" y="157" class="badge">38.4k â­</text>
    
    <rect x="150" y="140" width="80" height="25" fill="#3498DB" rx="12" ry="12"/>
    <text x="190" y="157" class="badge">3.7k Forks</text>
    
    <rect x="250" y="140" width="100" height="25" fill="#E74C3C" rx="12" ry="12"/>
    <text x="300" y="157" class="badge">GPL-2.0</text>
    
    <!-- Key Features -->
    <text x="50" y="200" class="feature">ğŸŒ å¤šåè®®æ”¯æŒ</text>
    <text x="200" y="200" class="feature">âš¡ é«˜æ€§èƒ½ä¸‹è½½</text>
    <text x="350" y="200" class="feature">ğŸ”§ å‘½ä»¤è¡Œå·¥å…·</text>
    <text x="500" y="200" class="feature">ğŸ“± è·¨å¹³å°</text>
    
    <text x="50" y="230" class="feature">ğŸ”— å¤šæºä¸‹è½½</text>
    <text x="200" y="230" class="feature">ğŸ¯ æ–­ç‚¹ç»­ä¼ </text>
    <text x="350" y="230" class="feature">ğŸ›¡ï¸ å®‰å…¨ä¼ è¾“</text>
    <text x="500" y="230" class="feature">ğŸ“Š è¯¦ç»†ç»Ÿè®¡</text>
    
    <text x="300" y="270" class="subtitle">å®˜ç½‘: aria2.github.io</text>
  </svg>
</div>

## æ ¸å¿ƒç‰¹æ€§

Aria2 æä¾›äº†å…¨é¢çš„ä¸‹è½½è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

- **ğŸŒ å¤šåè®®æ”¯æŒ**ï¼šHTTP/HTTPSã€FTPã€SFTPã€BitTorrentã€Metalink
- **âš¡ é«˜æ€§èƒ½**ï¼šå¤šçº¿ç¨‹ä¸‹è½½ï¼Œæ”¯æŒå¹¶å‘è¿æ¥
- **ğŸ”— å¤šæºä¸‹è½½**ï¼šä»å¤šä¸ªæºåŒæ—¶ä¸‹è½½åŒä¸€æ–‡ä»¶
- **ğŸ¯ æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒä¸‹è½½ä¸­æ–­åç»§ç»­ä¸‹è½½
- **ğŸ›¡ï¸ å®‰å…¨ä¼ è¾“**ï¼šæ”¯æŒ SSL/TLS åŠ å¯†
- **ğŸ“Š è¯¦ç»†ç»Ÿè®¡**ï¼šæä¾›ä¸‹è½½è¿›åº¦å’Œé€Ÿåº¦ç»Ÿè®¡
- **ğŸ”§ çµæ´»é…ç½®**ï¼šä¸°å¯Œçš„å‘½ä»¤è¡Œé€‰é¡¹å’Œé…ç½®æ–‡ä»¶
- **ğŸ“± è·¨å¹³å°**ï¼šæ”¯æŒ Linuxã€macOSã€Windowsã€Android

## ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph "ç”¨æˆ·å±‚"
        A[å‘½ä»¤è¡Œç•Œé¢]
        B[RPC æ¥å£]
        C[WebSocket æ¥å£]
    end
    
    subgraph "åè®®å±‚"
        D[HTTP/HTTPS ä¸‹è½½å™¨]
        E[FTP/SFTP ä¸‹è½½å™¨]
        F[BitTorrent ä¸‹è½½å™¨]
        G[Metalink è§£æå™¨]
    end
    
    subgraph "æ ¸å¿ƒå¼•æ“"
        H[ä¸‹è½½ç®¡ç†å™¨]
        I[è¿æ¥æ± ]
        J[æ–‡ä»¶ç®¡ç†å™¨]
        K[ç»Ÿè®¡æ”¶é›†å™¨]
    end
    
    subgraph "å­˜å‚¨å±‚"
        L[é…ç½®æ–‡ä»¶]
        M[ä¼šè¯æ–‡ä»¶]
        N[ä¸´æ—¶æ–‡ä»¶]
        O[ä¸‹è½½ç›®å½•]
    end
    
    A --> H
    B --> H
    C --> H
    
    H --> D
    H --> E
    H --> F
    H --> G
    
    D --> I
    E --> I
    F --> I
    G --> I
    
    I --> J
    J --> K
    
    H --> L
    H --> M
    H --> N
    H --> O
    
    style A fill:#e1f5fe
    style H fill:#fff3e0
    style I fill:#e8f5e8
    style K fill:#fce4ec
```

## å®‰è£…æŒ‡å—

### Linux å®‰è£…

#### Ubuntu/Debian
```bash
# ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…
sudo apt update
sudo apt install aria2

# æˆ–è€…ä»æºç ç¼–è¯‘
sudo apt install build-essential libssl-dev libssh2-1-dev libc-ares-dev libxml2-dev zlib1g-dev libgmp-dev libssh2-1-dev libc-ares-dev libxml2-dev zlib1g-dev libgmp-dev
git clone https://github.com/aria2/aria2.git
cd aria2
./configure
make
sudo make install
```

#### CentOS/RHEL
```bash
# ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…
sudo yum install aria2

# æˆ–è€…ä»æºç ç¼–è¯‘
sudo yum groupinstall "Development Tools"
sudo yum install openssl-devel libssh2-devel c-ares-devel libxml2-devel zlib-devel gmp-devel
git clone https://github.com/aria2/aria2.git
cd aria2
./configure
make
sudo make install
```

### macOS å®‰è£…

```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install aria2

# æˆ–è€…ä½¿ç”¨ MacPorts
sudo port install aria2
```

### Windows å®‰è£…

1. ä¸‹è½½é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼šhttps://github.com/aria2/aria2/releases
2. è§£å‹åˆ°æŒ‡å®šç›®å½•
3. å°† aria2c.exe æ‰€åœ¨ç›®å½•æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡

### éªŒè¯å®‰è£…

```bash
aria2c --version
```

## åŸºç¡€ä½¿ç”¨

### åŸºæœ¬ä¸‹è½½å‘½ä»¤

```bash
# ä¸‹è½½å•ä¸ªæ–‡ä»¶
aria2c "https://example.com/file.zip"

# ä¸‹è½½åˆ°æŒ‡å®šç›®å½•
aria2c -d /path/to/download "https://example.com/file.zip"

# é‡å‘½åä¸‹è½½æ–‡ä»¶
aria2c -o newname.zip "https://example.com/file.zip"

# é™åˆ¶ä¸‹è½½é€Ÿåº¦
aria2c --max-download-limit=1M "https://example.com/file.zip"
```

### å¤šçº¿ç¨‹ä¸‹è½½

```bash
# ä½¿ç”¨ 16 ä¸ªè¿æ¥ä¸‹è½½
aria2c -x 16 "https://example.com/file.zip"

# ä½¿ç”¨ 16 ä¸ªè¿æ¥ï¼Œæ¯ä¸ªè¿æ¥æœ€å¤š 5 ä¸ªåˆ†ç‰‡
aria2c -x 16 -s 5 "https://example.com/file.zip"
```

### æ–­ç‚¹ç»­ä¼ 

```bash
# å¯ç”¨æ–­ç‚¹ç»­ä¼ 
aria2c -c "https://example.com/file.zip"

# ä»æŒ‡å®šä½ç½®ç»§ç»­ä¸‹è½½
aria2c -c -S "https://example.com/file.zip"
```

## é«˜çº§åŠŸèƒ½

### BitTorrent ä¸‹è½½

```bash
# ä¸‹è½½ç§å­æ–‡ä»¶
aria2c "https://example.com/file.torrent"

# æŒ‡å®šä¸‹è½½ç›®å½•
aria2c -d /path/to/download "https://example.com/file.torrent"

# è®¾ç½®ä¸Šä¼ é€Ÿåº¦é™åˆ¶
aria2c --max-upload-limit=1M "https://example.com/file.torrent"

# å¯ç”¨ DHT
aria2c --enable-dht "https://example.com/file.torrent"
```

### Metalink ä¸‹è½½

```bash
# ä¸‹è½½ Metalink æ–‡ä»¶
aria2c "https://example.com/file.metalink"

# æŒ‡å®šé¦–é€‰è¯­è¨€
aria2c --metalink-language=zh-CN "https://example.com/file.metalink"

# æŒ‡å®šé¦–é€‰ä½ç½®
aria2c --metalink-location=CN "https://example.com/file.metalink"
```

### FTP/SFTP ä¸‹è½½

```bash
# FTP ä¸‹è½½
aria2c "ftp://user:pass@example.com/file.zip"

# SFTP ä¸‹è½½
aria2c "sftp://user@example.com/file.zip"

# ä½¿ç”¨ SSH å¯†é’¥
aria2c --ssh-private-key=/path/to/private_key "sftp://user@example.com/file.zip"
```

## é…ç½®æ–‡ä»¶

### åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p ~/.aria2

# åˆ›å»ºé…ç½®æ–‡ä»¶
touch ~/.aria2/aria2.conf
```

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

```ini
# åŸºæœ¬è®¾ç½®
dir=/home/user/Downloads
input-file=/home/user/.aria2/aria2.session
save-session=/home/user/.aria2/aria2.session
save-session-interval=60

# è¿æ¥è®¾ç½®
max-concurrent-downloads=5
max-connection-per-server=16
min-split-size=10M
split=10
max-overall-download-limit=0
max-download-limit=0
max-overall-upload-limit=1M
max-upload-limit=1000

# BitTorrent è®¾ç½®
enable-dht=true
enable-peer-exchange=true
listen-port=6881-6999
dht-listen-port=6881-6999

# RPC è®¾ç½®
enable-rpc=true
rpc-allow-origin-all=true
rpc-listen-all=true
rpc-listen-port=6800
rpc-secret=your_secret_key

# æ—¥å¿—è®¾ç½®
log=/home/user/.aria2/aria2.log
log-level=notice
```

### ä½¿ç”¨é…ç½®æ–‡ä»¶

```bash
# ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨
aria2c --conf-path=/path/to/aria2.conf

# æˆ–è€…ä½¿ç”¨é»˜è®¤ä½ç½®
aria2c --conf-path=~/.aria2/aria2.conf
```

## RPC æ¥å£

### å¯åŠ¨ RPC æœåŠ¡

```bash
# å¯åŠ¨ RPC æœåŠ¡
aria2c --enable-rpc --rpc-listen-all --rpc-allow-origin-all

# æŒ‡å®šç«¯å£å’Œå¯†é’¥
aria2c --enable-rpc --rpc-listen-port=6800 --rpc-secret=your_secret
```

### JSON-RPC ç¤ºä¾‹

```bash
# æ·»åŠ ä¸‹è½½ä»»åŠ¡
curl -X POST -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":"1","method":"aria2.addUri","params":[["https://example.com/file.zip"]]}' \
  http://localhost:6800/jsonrpc

# è·å–ä¸‹è½½çŠ¶æ€
curl -X POST -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":"1","method":"aria2.tellStatus","params":["gid"]}' \
  http://localhost:6800/jsonrpc

# æš‚åœä¸‹è½½
curl -X POST -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":"1","method":"aria2.pause","params":["gid"]}' \
  http://localhost:6800/jsonrpc
```

## WebSocket æ¥å£

```javascript
// è¿æ¥ WebSocket
const ws = new WebSocket('ws://localhost:6800/jsonrpc');

// æ·»åŠ ä¸‹è½½ä»»åŠ¡
ws.send(JSON.stringify({
  jsonrpc: '2.0',
  id: '1',
  method: 'aria2.addUri',
  params: [['https://example.com/file.zip']]
}));

// ç›‘å¬ä¸‹è½½è¿›åº¦
ws.onmessage = function(event) {
  const data = JSON.parse(event.data);
  console.log('Download progress:', data);
};
```

## å®ç”¨è„šæœ¬

### æ‰¹é‡ä¸‹è½½è„šæœ¬

```bash
#!/bin/bash
# æ‰¹é‡ä¸‹è½½è„šæœ¬

# è¯»å– URL åˆ—è¡¨æ–‡ä»¶
while IFS= read -r url; do
  echo "Downloading: $url"
  aria2c -c -x 16 -s 16 "$url"
done < urls.txt
```

### ç›‘æ§ä¸‹è½½è¿›åº¦

```bash
#!/bin/bash
# ç›‘æ§ä¸‹è½½è¿›åº¦

while true; do
  clear
  echo "=== Aria2 Download Status ==="
  aria2c --show-files --summary-interval=1
  sleep 2
done
```

### è‡ªåŠ¨é‡è¯•è„šæœ¬

```bash
#!/bin/bash
# è‡ªåŠ¨é‡è¯•ä¸‹è½½

max_retries=3
retry_count=0

while [ $retry_count -lt $max_retries ]; do
  if aria2c "$1"; then
    echo "Download completed successfully"
    break
  else
    retry_count=$((retry_count + 1))
    echo "Download failed, retrying... ($retry_count/$max_retries)"
    sleep 5
  fi
done
```

## æ€§èƒ½ä¼˜åŒ–

### ç½‘ç»œä¼˜åŒ–

```bash
# ä¼˜åŒ–è¿æ¥æ•°
aria2c -x 16 -s 16 "https://example.com/file.zip"

# å¯ç”¨ HTTP/2
aria2c --http-accept-gzip=true "https://example.com/file.zip"

# è®¾ç½®è¶…æ—¶
aria2c --connect-timeout=10 --timeout=10 "https://example.com/file.zip"
```

### ç£ç›˜ä¼˜åŒ–

```bash
# ä½¿ç”¨å†…å­˜ç¼“å­˜
aria2c --file-allocation=none "https://example.com/file.zip"

# é¢„åˆ†é…ç£ç›˜ç©ºé—´
aria2c --file-allocation=prealloc "https://example.com/file.zip"

# ä½¿ç”¨ç›´æ¥ I/O
aria2c --file-allocation=falloc "https://example.com/file.zip"
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ä¸‹è½½é€Ÿåº¦æ…¢
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping example.com

# å¢åŠ è¿æ¥æ•°
aria2c -x 32 -s 16 "https://example.com/file.zip"

# æ£€æŸ¥æœåŠ¡å™¨é™åˆ¶
aria2c --max-download-limit=0 "https://example.com/file.zip"
```

#### 2. è¿æ¥è¶…æ—¶
```bash
# å¢åŠ è¶…æ—¶æ—¶é—´
aria2c --connect-timeout=30 --timeout=30 "https://example.com/file.zip"

# ä½¿ç”¨ä»£ç†
aria2c --all-proxy="http://proxy:port" "https://example.com/file.zip"
```

#### 3. BitTorrent è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥ç«¯å£è½¬å‘
aria2c --listen-port=6881-6999 "https://example.com/file.torrent"

# å¯ç”¨ UPnP
aria2c --enable-upnp "https://example.com/file.torrent"

# æ·»åŠ  tracker
aria2c --bt-tracker="udp://tracker.example.com:1337/announce" "https://example.com/file.torrent"
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
aria2c --log-level=debug "https://example.com/file.zip"

# è¾“å‡ºåˆ°æ–‡ä»¶
aria2c --log=/path/to/aria2.log --log-level=debug "https://example.com/file.zip"
```

## æœ€ä½³å®è·µ

### 1. é…ç½®æ–‡ä»¶ç®¡ç†

```bash
# åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶
~/.aria2/aria2.conf          # é»˜è®¤é…ç½®
~/.aria2/aria2-fast.conf     # é«˜é€Ÿä¸‹è½½é…ç½®
~/.aria2/aria2-bt.conf       # BitTorrent é…ç½®
```

### 2. ä¼šè¯ç®¡ç†

```bash
# ä¿å­˜ä¼šè¯çŠ¶æ€
aria2c --save-session=/path/to/session.txt "https://example.com/file.zip"

# ä»ä¼šè¯æ¢å¤
aria2c --input-file=/path/to/session.txt
```

### 3. ç›‘æ§å’Œç»Ÿè®¡

```bash
# å®æ—¶ç›‘æ§
watch -n 1 'aria2c --show-files'

# ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
aria2c --summary-interval=1 --log=/path/to/download.log
```

## é›†æˆç¤ºä¾‹

### ä¸ Python é›†æˆ

```python
import json
import requests

class Aria2Client:
    def __init__(self, rpc_url="http://localhost:6800/jsonrpc"):
        self.rpc_url = rpc_url
    
    def add_uri(self, uris, options=None):
        params = [uris]
        if options:
            params.append(options)
        
        data = {
            "jsonrpc": "2.0",
            "id": "1",
            "method": "aria2.addUri",
            "params": params
        }
        
        response = requests.post(self.rpc_url, json=data)
        return response.json()
    
    def get_status(self, gid):
        data = {
            "jsonrpc": "2.0",
            "id": "1",
            "method": "aria2.tellStatus",
            "params": [gid]
        }
        
        response = requests.post(self.rpc_url, json=data)
        return response.json()

# ä½¿ç”¨ç¤ºä¾‹
client = Aria2Client()
result = client.add_uri(["https://example.com/file.zip"])
print(f"Download started with GID: {result['result']}")
```

### ä¸ Node.js é›†æˆ

```javascript
const WebSocket = require('ws');

class Aria2WebSocket {
    constructor(host = 'localhost', port = 6800) {
        this.ws = new WebSocket(`ws://${host}:${port}/jsonrpc`);
        this.messageId = 1;
    }
    
    addUri(uris, options = {}) {
        const message = {
            jsonrpc: '2.0',
            id: this.messageId++,
            method: 'aria2.addUri',
            params: [uris, options]
        };
        
        this.ws.send(JSON.stringify(message));
    }
    
    onMessage(callback) {
        this.ws.on('message', (data) => {
            const message = JSON.parse(data);
            callback(message);
        });
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const aria2 = new Aria2WebSocket();
aria2.addUri(['https://example.com/file.zip']);
aria2.onMessage((message) => {
    console.log('Received:', message);
});
```

## é«˜çº§é…ç½®ç¤ºä¾‹

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```ini
# ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ ~/.aria2/aria2-prod.conf

# åŸºæœ¬è®¾ç½®
dir=/data/downloads
input-file=/data/aria2/aria2.session
save-session=/data/aria2/aria2.session
save-session-interval=60
auto-save-interval=60

# è¿æ¥ä¼˜åŒ–
max-concurrent-downloads=10
max-connection-per-server=16
min-split-size=10M
split=10
max-overall-download-limit=0
max-download-limit=0
max-overall-upload-limit=1M
max-upload-limit=1000

# ç½‘ç»œä¼˜åŒ–
connect-timeout=10
timeout=10
retry-wait=3
max-tries=5
retry-wait=3

# BitTorrent ä¼˜åŒ–
enable-dht=true
enable-peer-exchange=true
listen-port=6881-6999
dht-listen-port=6881-6999
bt-max-peers=55
bt-request-peer-speed-limit=50K

# RPC è®¾ç½®
enable-rpc=true
rpc-allow-origin-all=true
rpc-listen-all=true
rpc-listen-port=6800
rpc-secret=your_secure_secret_key

# æ—¥å¿—è®¾ç½®
log=/var/log/aria2.log
log-level=notice
console-log-level=notice

# å®‰å…¨è®¾ç½®
rpc-secure=false
rpc-certificate=/path/to/cert.pem
rpc-private-key=/path/to/key.pem
```

### å¼€å‘ç¯å¢ƒé…ç½®

```ini
# å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶ ~/.aria2/aria2-dev.conf

# åŸºæœ¬è®¾ç½®
dir=~/Downloads/aria2
input-file=~/.aria2/aria2-dev.session
save-session=~/.aria2/aria2-dev.session
save-session-interval=30

# è°ƒè¯•è®¾ç½®
log=~/.aria2/aria2-dev.log
log-level=debug
console-log-level=debug

# å¼€å‘æµ‹è¯•è®¾ç½®
max-concurrent-downloads=3
max-connection-per-server=8
min-split-size=1M
split=5

# RPC è®¾ç½®
enable-rpc=true
rpc-listen-all=true
rpc-listen-port=6801
rpc-secret=dev_secret

# æµ‹è¯•è®¾ç½®
max-overall-download-limit=10M
max-download-limit=5M
```

## ç›‘æ§å’Œæ—¥å¿—åˆ†æ

### å®æ—¶ç›‘æ§è„šæœ¬

```bash
#!/bin/bash
# aria2-monitor.sh - å®æ—¶ç›‘æ§ Aria2 ä¸‹è½½çŠ¶æ€

LOG_FILE="/var/log/aria2.log"
RPC_PORT="6800"

echo "=== Aria2 å®æ—¶ç›‘æ§ ==="
echo "æ—¶é—´: $(date)"
echo "========================"

# æ£€æŸ¥ Aria2 è¿›ç¨‹
if pgrep -x "aria2c" > /dev/null; then
    echo "âœ… Aria2 è¿›ç¨‹è¿è¡Œä¸­"
else
    echo "âŒ Aria2 è¿›ç¨‹æœªè¿è¡Œ"
    exit 1
fi

# è·å–ä¸‹è½½çŠ¶æ€
echo ""
echo "ğŸ“Š å½“å‰ä¸‹è½½ä»»åŠ¡:"
aria2c --show-files --summary-interval=1 2>/dev/null | head -20

# æ£€æŸ¥ RPC è¿æ¥
echo ""
echo "ğŸ”Œ RPC è¿æ¥çŠ¶æ€:"
if curl -s "http://localhost:${RPC_PORT}/jsonrpc" > /dev/null; then
    echo "âœ… RPC æœåŠ¡æ­£å¸¸"
else
    echo "âŒ RPC æœåŠ¡å¼‚å¸¸"
fi

# æ˜¾ç¤ºæœ€è¿‘çš„æ—¥å¿—
echo ""
echo "ğŸ“ æœ€è¿‘æ—¥å¿— (æœ€å 10 è¡Œ):"
tail -10 "$LOG_FILE" 2>/dev/null || echo "æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨"
```

### æ—¥å¿—åˆ†æå·¥å…·

```python
#!/usr/bin/env python3
# aria2-log-analyzer.py - Aria2 æ—¥å¿—åˆ†æå·¥å…·

import re
import sys
from datetime import datetime
from collections import defaultdict

class Aria2LogAnalyzer:
    def __init__(self, log_file):
        self.log_file = log_file
        self.stats = defaultdict(int)
        self.errors = []
        self.downloads = []
    
    def analyze(self):
        """åˆ†ææ—¥å¿—æ–‡ä»¶"""
        try:
            with open(self.log_file, 'r') as f:
                for line in f:
                    self.parse_line(line)
        except FileNotFoundError:
            print(f"é”™è¯¯: æ—¥å¿—æ–‡ä»¶ {self.log_file} ä¸å­˜åœ¨")
            return
        
        self.print_report()
    
    def parse_line(self, line):
        """è§£æå•è¡Œæ—¥å¿—"""
        # ä¸‹è½½å®Œæˆ
        if "Download Results:" in line:
            self.stats['completed_downloads'] += 1
        
        # ä¸‹è½½é”™è¯¯
        elif "error occurred" in line.lower():
            self.stats['errors'] += 1
            self.errors.append(line.strip())
        
        # è¿æ¥é”™è¯¯
        elif "connection error" in line.lower():
            self.stats['connection_errors'] += 1
        
        # è¶…æ—¶é”™è¯¯
        elif "timeout" in line.lower():
            self.stats['timeout_errors'] += 1
    
    def print_report(self):
        """æ‰“å°åˆ†ææŠ¥å‘Š"""
        print("=== Aria2 æ—¥å¿—åˆ†ææŠ¥å‘Š ===")
        print(f"åˆ†ææ—¶é—´: {datetime.now()}")
        print(f"æ—¥å¿—æ–‡ä»¶: {self.log_file}")
        print("")
        
        print("ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:")
        print(f"  å®Œæˆä¸‹è½½: {self.stats['completed_downloads']}")
        print(f"  æ€»é”™è¯¯æ•°: {self.stats['errors']}")
        print(f"  è¿æ¥é”™è¯¯: {self.stats['connection_errors']}")
        print(f"  è¶…æ—¶é”™è¯¯: {self.stats['timeout_errors']}")
        
        if self.errors:
            print("")
            print("âŒ æœ€è¿‘é”™è¯¯:")
            for error in self.errors[-5:]:
                print(f"  {error}")

if __name__ == "__main__":
    log_file = sys.argv[1] if len(sys.argv) > 1 else "/var/log/aria2.log"
    analyzer = Aria2LogAnalyzer(log_file)
    analyzer.analyze()
```

## è‡ªåŠ¨åŒ–ä¸‹è½½ç®¡ç†

### æ™ºèƒ½ä¸‹è½½è°ƒåº¦å™¨

```python
#!/usr/bin/env python3
# aria2-scheduler.py - æ™ºèƒ½ä¸‹è½½è°ƒåº¦å™¨

import json
import time
import requests
import schedule
from datetime import datetime
import logging

class Aria2Scheduler:
    def __init__(self, rpc_url="http://localhost:6800/jsonrpc"):
        self.rpc_url = rpc_url
        self.download_queue = []
        self.max_concurrent = 5
        self.current_downloads = 0
        
        # è®¾ç½®æ—¥å¿—
        logging.basicConfig(
            level=logging.INFO,
            format='%(asctime)s - %(levelname)s - %(message)s',
            filename='aria2-scheduler.log'
        )
        self.logger = logging.getLogger(__name__)
    
    def add_download(self, uri, options=None):
        """æ·»åŠ ä¸‹è½½ä»»åŠ¡åˆ°é˜Ÿåˆ—"""
        task = {
            'uri': uri,
            'options': options or {},
            'added_time': datetime.now(),
            'status': 'pending'
        }
        self.download_queue.append(task)
        self.logger.info(f"æ·»åŠ ä¸‹è½½ä»»åŠ¡: {uri}")
    
    def start_download(self, task):
        """å¼€å§‹ä¸‹è½½ä»»åŠ¡"""
        try:
            data = {
                "jsonrpc": "2.0",
                "id": "1",
                "method": "aria2.addUri",
                "params": [[task['uri']], task['options']]
            }
            
            response = requests.post(self.rpc_url, json=data, timeout=10)
            result = response.json()
            
            if 'result' in result:
                task['gid'] = result['result']
                task['status'] = 'downloading'
                self.current_downloads += 1
                self.logger.info(f"å¼€å§‹ä¸‹è½½: {task['uri']} (GID: {task['gid']})")
                return True
            else:
                self.logger.error(f"ä¸‹è½½å¤±è´¥: {task['uri']}")
                return False
                
        except Exception as e:
            self.logger.error(f"ä¸‹è½½å¼‚å¸¸: {task['uri']} - {str(e)}")
            return False
    
    def check_completed_downloads(self):
        """æ£€æŸ¥å·²å®Œæˆçš„ä¸‹è½½"""
        try:
            data = {
                "jsonrpc": "2.0",
                "id": "1",
                "method": "aria2.tellActive",
                "params": []
            }
            
            response = requests.post(self.rpc_url, json=data, timeout=10)
            result = response.json()
            
            active_downloads = len(result.get('result', []))
            self.current_downloads = active_downloads
            
        except Exception as e:
            self.logger.error(f"æ£€æŸ¥ä¸‹è½½çŠ¶æ€å¤±è´¥: {str(e)}")
    
    def process_queue(self):
        """å¤„ç†ä¸‹è½½é˜Ÿåˆ—"""
        self.check_completed_downloads()
        
        # å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡
        for task in self.download_queue[:]:
            if task['status'] == 'pending' and self.current_downloads < self.max_concurrent:
                if self.start_download(task):
                    self.download_queue.remove(task)
        
        # æ¸…ç†å·²å®Œæˆçš„ä»»åŠ¡
        self.download_queue = [task for task in self.download_queue if task['status'] != 'completed']
    
    def run_scheduler(self):
        """è¿è¡Œè°ƒåº¦å™¨"""
        self.logger.info("å¯åŠ¨ Aria2 ä¸‹è½½è°ƒåº¦å™¨")
        
        # è®¾ç½®å®šæ—¶ä»»åŠ¡
        schedule.every(30).seconds.do(self.process_queue)
        schedule.every().hour.do(self.log_status)
        
        while True:
            schedule.run_pending()
            time.sleep(1)
    
    def log_status(self):
        """è®°å½•çŠ¶æ€"""
        self.logger.info(f"çŠ¶æ€: å½“å‰ä¸‹è½½ {self.current_downloads}/{self.max_concurrent}, é˜Ÿåˆ—ä¸­ {len(self.download_queue)} ä¸ªä»»åŠ¡")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    scheduler = Aria2Scheduler()
    
    # æ·»åŠ ä¸‹è½½ä»»åŠ¡
    scheduler.add_download("https://example.com/file1.zip")
    scheduler.add_download("https://example.com/file2.zip")
    scheduler.add_download("https://example.com/file3.zip")
    
    # è¿è¡Œè°ƒåº¦å™¨
    scheduler.run_scheduler()
```

### æ‰¹é‡ä¸‹è½½ç®¡ç†å™¨

```bash
#!/bin/bash
# aria2-batch-manager.sh - æ‰¹é‡ä¸‹è½½ç®¡ç†å™¨

# é…ç½®
DOWNLOAD_DIR="/data/downloads"
CONFIG_FILE="$HOME/.aria2/aria2.conf"
LOG_FILE="$HOME/.aria2/batch.log"
MAX_CONCURRENT=5

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥ Aria2 æ˜¯å¦è¿è¡Œ
check_aria2() {
    if ! pgrep -x "aria2c" > /dev/null; then
        log "${RED}é”™è¯¯: Aria2 æœªè¿è¡Œ${NC}"
        log "å¯åŠ¨ Aria2..."
        aria2c --conf-path="$CONFIG_FILE" --daemon
        sleep 2
    fi
}

# æ·»åŠ ä¸‹è½½ä»»åŠ¡
add_download() {
    local url="$1"
    local filename="$2"
    
    log "${GREEN}æ·»åŠ ä¸‹è½½: $url${NC}"
    
    if [ -n "$filename" ]; then
        aria2c --conf-path="$CONFIG_FILE" -o "$filename" "$url"
    else
        aria2c --conf-path="$CONFIG_FILE" "$url"
    fi
}

# æ‰¹é‡ä¸‹è½½
batch_download() {
    local url_file="$1"
    
    if [ ! -f "$url_file" ]; then
        log "${RED}é”™è¯¯: URL æ–‡ä»¶ä¸å­˜åœ¨: $url_file${NC}"
        exit 1
    fi
    
    log "${YELLOW}å¼€å§‹æ‰¹é‡ä¸‹è½½: $url_file${NC}"
    
    local count=0
    while IFS= read -r line; do
        # è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
        [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue
        
        # è§£æ URL å’Œæ–‡ä»¶å
        if [[ "$line" =~ ^([^[:space:]]+)[[:space:]]+(.+)$ ]]; then
            url="${BASH_REMATCH[1]}"
            filename="${BASH_REMATCH[2]}"
        else
            url="$line"
            filename=""
        fi
        
        add_download "$url" "$filename"
        count=$((count + 1))
        
        # æ§åˆ¶å¹¶å‘æ•°
        if [ $((count % MAX_CONCURRENT)) -eq 0 ]; then
            log "${YELLOW}ç­‰å¾…ä¸‹è½½é˜Ÿåˆ—å¤„ç†...${NC}"
            sleep 10
        fi
    done < "$url_file"
    
    log "${GREEN}æ‰¹é‡ä¸‹è½½å®Œæˆï¼Œå…± $count ä¸ªä»»åŠ¡${NC}"
}

# ç›‘æ§ä¸‹è½½çŠ¶æ€
monitor_downloads() {
    log "${YELLOW}ç›‘æ§ä¸‹è½½çŠ¶æ€...${NC}"
    
    while true; do
        clear
        echo "=== Aria2 ä¸‹è½½ç›‘æ§ ==="
        echo "æ—¶é—´: $(date)"
        echo "========================"
        
        # æ˜¾ç¤ºæ´»åŠ¨ä¸‹è½½
        echo "ğŸ“¥ æ´»åŠ¨ä¸‹è½½:"
        aria2c --show-files --summary-interval=1 2>/dev/null | head -10
        
        # æ˜¾ç¤ºé˜Ÿåˆ—çŠ¶æ€
        echo ""
        echo "ğŸ“‹ é˜Ÿåˆ—çŠ¶æ€:"
        aria2c --show-files 2>/dev/null | grep -c "pending" || echo "0"
        
        sleep 5
    done
}

# ä¸»å‡½æ•°
main() {
    case "${1:-}" in
        "add")
            check_aria2
            add_download "$2" "$3"
            ;;
        "batch")
            check_aria2
            batch_download "$2"
            ;;
        "monitor")
            monitor_downloads
            ;;
        "status")
            aria2c --show-files
            ;;
        *)
            echo "ç”¨æ³•: $0 {add|batch|monitor|status} [å‚æ•°]"
            echo "  add <url> [filename]  - æ·»åŠ å•ä¸ªä¸‹è½½"
            echo "  batch <url_file>      - æ‰¹é‡ä¸‹è½½"
            echo "  monitor               - ç›‘æ§ä¸‹è½½çŠ¶æ€"
            echo "  status                - æ˜¾ç¤ºä¸‹è½½çŠ¶æ€"
            exit 1
            ;;
    esac
}

main "$@"
```

## å®‰å…¨é…ç½®

### SSL/TLS é…ç½®

```ini
# SSL/TLS å®‰å…¨é…ç½®
check-certificate=true
ca-certificate=/path/to/ca-certificates.crt
certificate=/path/to/client-cert.pem
private-key=/path/to/client-key.pem

# ä»£ç†è®¾ç½®
all-proxy=http://proxy.example.com:8080
all-proxy-user=username
all-proxy-passwd=password

# å®‰å…¨ä¸‹è½½è®¾ç½®
lowest-speed-limit=1K
max-overall-download-limit=0
max-download-limit=0
```

### è®¿é—®æ§åˆ¶

```ini
# RPC è®¿é—®æ§åˆ¶
rpc-allow-origin-all=false
rpc-allow-origin-all=true
rpc-listen-all=false
rpc-listen-address=127.0.0.1
rpc-secret=your_secure_secret_key

# ç”¨æˆ·è®¤è¯
rpc-user=aria2user
rpc-passwd=secure_password
```

## æ€§èƒ½åŸºå‡†æµ‹è¯•

### ä¸‹è½½æ€§èƒ½æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# aria2-benchmark.sh - Aria2 æ€§èƒ½åŸºå‡†æµ‹è¯•

# æµ‹è¯•é…ç½®
TEST_URL="https://speed.hetzner.de/100MB.bin"
TEST_FILE="test_100mb.bin"
LOG_FILE="aria2_benchmark.log"

# æµ‹è¯•å‚æ•°
CONCURRENT_TESTS=(1 2 4 8 16)
CONNECTION_TESTS=(1 4 8 16 32)

echo "=== Aria2 æ€§èƒ½åŸºå‡†æµ‹è¯• ==="
echo "æµ‹è¯•æ—¶é—´: $(date)"
echo "æµ‹è¯•æ–‡ä»¶: $TEST_URL"
echo "================================"

# æ¸…ç†æ—§æ–‡ä»¶
rm -f "$TEST_FILE" "$LOG_FILE"

# åŸºå‡†æµ‹è¯•å‡½æ•°
run_benchmark() {
    local connections="$1"
    local concurrent="$2"
    
    echo "æµ‹è¯•é…ç½®: $connections è¿æ¥, $concurrent å¹¶å‘"
    
    # å¼€å§‹ä¸‹è½½
    start_time=$(date +%s)
    aria2c -x "$connections" -s "$connections" -c "$TEST_URL" 2>/dev/null
    end_time=$(date +%s)
    
    # è®¡ç®—æ€§èƒ½æŒ‡æ ‡
    duration=$((end_time - start_time))
    speed=$(echo "scale=2; 100 / $duration" | bc)
    
    echo "  è€—æ—¶: ${duration}s"
    echo "  é€Ÿåº¦: ${speed}MB/s"
    echo "  è¿æ¥æ•°: $connections"
    echo "  å¹¶å‘æ•°: $concurrent"
    echo "---"
    
    # è®°å½•ç»“æœ
    echo "$connections,$concurrent,$duration,$speed" >> "$LOG_FILE"
    
    # æ¸…ç†æµ‹è¯•æ–‡ä»¶
    rm -f "$TEST_FILE"
    sleep 2
}

# è¿è¡Œæµ‹è¯•
echo "å¼€å§‹æ€§èƒ½æµ‹è¯•..."
echo "connections,concurrent,duration,speed" > "$LOG_FILE"

for conn in "${CONNECTION_TESTS[@]}"; do
    for conc in "${CONCURRENT_TESTS[@]}"; do
        run_benchmark "$conn" "$conc"
    done
done

# ç”ŸæˆæŠ¥å‘Š
echo ""
echo "=== æµ‹è¯•ç»“æœæ±‡æ€» ==="
echo "æœ€ä½³æ€§èƒ½é…ç½®:"
sort -t',' -k4 -nr "$LOG_FILE" | head -5 | while IFS=',' read -r conn conc dur speed; do
    echo "  è¿æ¥æ•°: $conn, å¹¶å‘æ•°: $conc, é€Ÿåº¦: ${speed}MB/s"
done

echo ""
echo "è¯¦ç»†ç»“æœå·²ä¿å­˜åˆ°: $LOG_FILE"
```

## æ€»ç»“

Aria2 æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€çµæ´»ä¸”é«˜æ•ˆçš„ä¸‹è½½å·¥å…·ï¼Œé€‚ç”¨äºå„ç§ä¸‹è½½åœºæ™¯ã€‚é€šè¿‡æœ¬æ–‡æ¡£çš„å­¦ä¹ ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿï¼š

1. **ç†è§£ Aria2 çš„æ ¸å¿ƒç‰¹æ€§**ï¼šå¤šåè®®æ”¯æŒã€é«˜æ€§èƒ½ä¸‹è½½ã€æ–­ç‚¹ç»­ä¼ ç­‰
2. **æŒæ¡å®‰è£…å’Œé…ç½®**ï¼šåœ¨ä¸åŒå¹³å°ä¸Šå®‰è£…å’Œé…ç½® Aria2
3. **ç†Ÿç»ƒä½¿ç”¨åŸºæœ¬åŠŸèƒ½**ï¼šå‘½ä»¤è¡Œä¸‹è½½ã€å¤šçº¿ç¨‹ã€æ–­ç‚¹ç»­ä¼ ç­‰
4. **åº”ç”¨é«˜çº§åŠŸèƒ½**ï¼šBitTorrentã€Metalinkã€RPC æ¥å£ç­‰
5. **è§£å†³å¸¸è§é—®é¢˜**ï¼šæ€§èƒ½ä¼˜åŒ–ã€æ•…éšœæ’é™¤ç­‰
6. **é›†æˆåˆ°å…¶ä»–åº”ç”¨**ï¼šé€šè¿‡ RPC å’Œ WebSocket æ¥å£é›†æˆ
7. **å®ç°è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šä½¿ç”¨è„šæœ¬å’Œå·¥å…·è¿›è¡Œæ‰¹é‡ä¸‹è½½ç®¡ç†
8. **ç¡®ä¿å®‰å…¨ä½¿ç”¨**ï¼šé…ç½® SSL/TLS å’Œè®¿é—®æ§åˆ¶
9. **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡åŸºå‡†æµ‹è¯•æ‰¾åˆ°æœ€ä½³é…ç½®

Aria2 çš„è½»é‡çº§è®¾è®¡å’Œå¼ºå¤§çš„åŠŸèƒ½ä½¿å…¶æˆä¸ºå‘½ä»¤è¡Œä¸‹è½½å·¥å…·çš„é¦–é€‰ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦è‡ªåŠ¨åŒ–ä¸‹è½½ç®¡ç†çš„åœºæ™¯ã€‚

## å‚è€ƒèµ„æº

- [Aria2 å®˜æ–¹æ–‡æ¡£](https://aria2.github.io/)
- [Aria2 GitHub ä»“åº“](https://github.com/aria2/aria2)
- [Aria2 åœ¨çº¿æ‰‹å†Œ](https://aria2.github.io/manual/en/html/)
- [Aria2 RPC æ¥å£æ–‡æ¡£](https://aria2.github.io/manual/en/html/aria2c.html#rpc-interface)
- [Aria2 é…ç½®ç¤ºä¾‹](https://github.com/aria2/aria2/tree/master/doc)

---

*æœ¬æ–‡æ¡£åŸºäº Aria2 1.37.0 ç‰ˆæœ¬ç¼–å†™ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç°ä»£æ“ä½œç³»ç»Ÿã€‚* 