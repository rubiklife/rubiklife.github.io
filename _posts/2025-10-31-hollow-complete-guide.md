---
title: "Netflix Hollow å®Œå…¨æŒ‡å—ï¼šé«˜æ•ˆå†…å­˜æ•°æ®é›†åˆ†å‘çš„å®è·µæ‰‹å†Œ"
date: 2025-10-31T06:00:00+08:00
categories:
  - å¼€å‘æ¡†æ¶
tags:
  - å¼€æº
  - å·¥å…·
toc: true
toc_label: "ç›®å½•"
toc_icon: "list"
mermaid: true
---

# Netflix Hollow å®Œå…¨æŒ‡å—ï¼šé«˜æ•ˆå†…å­˜æ•°æ®é›†åˆ†å‘çš„å®è·µæ‰‹å†Œ

## ç®€ä»‹

Netflix Hollow æ˜¯ Netflix å¼€æºçš„ä¸€ä¸ªç”¨äºé«˜æ•ˆåˆ†å‘å’Œæ¶ˆè´¹å¤§è§„æ¨¡å†…å­˜æ•°æ®é›†çš„ Java åº“ã€‚å®ƒé€šè¿‡å»é‡ã€å‹ç¼©ç­‰æŠ€æœ¯ï¼Œæ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ï¼Œé€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿæ•°æ®è®¿é—®çš„åœºæ™¯ã€‚Hollow è®¾è®¡ç”¨äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸­åˆ†å‘å¤§å‹åªè¯»æ•°æ®é›†ï¼Œä½¿å¾—æ¶ˆè´¹è€…åº”ç”¨å¯ä»¥åœ¨æœ¬åœ°å†…å­˜ä¸­å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œè€Œæ— éœ€æ¯æ¬¡æŸ¥è¯¢éƒ½è®¿é—®æ•°æ®åº“æˆ–è¿œç¨‹æœåŠ¡ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

- ğŸš€ **é«˜æ•ˆå†…å­˜ä½¿ç”¨**ï¼šé€šè¿‡å»é‡å’Œå‹ç¼©æŠ€æœ¯ï¼Œåœ¨å†…å­˜ä¸­å­˜å‚¨æ›´å¤§çš„æ•°æ®é›†
- âš¡ **å¿«é€Ÿæ•°æ®è®¿é—®**ï¼šæä¾›ä½å»¶è¿Ÿçš„æ•°æ®è¯»å–ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„è¯»å–æ“ä½œ
- ğŸ”„ **å¢é‡æ›´æ–°**ï¼šæ”¯æŒæ•°æ®çš„åŸå­æ€§å¢é‡æ›´æ–°ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’Œå†…å­˜å ç”¨
- ğŸ”’ **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿æ¶ˆè´¹è€…å§‹ç»ˆè¯»å–åˆ°ä¸€è‡´çš„æ•°æ®è§†å›¾
- ğŸ“¦ **è½»é‡çº§**ï¼šæ— éœ€æ•°æ®åº“ï¼Œæ•°æ®ç›´æ¥å­˜å‚¨åœ¨ JVM å †å†…å­˜ä¸­
- ğŸŒ **åˆ†å¸ƒå¼å‹å¥½**ï¼šæ”¯æŒé€šè¿‡å‘å¸ƒ-è®¢é˜…ç³»ç»Ÿåˆ†å‘æ•°æ®å¿«ç…§å’Œå¢é‡æ›´æ–°

### é€‚ç”¨åœºæ™¯

- **é…ç½®æ•°æ®åˆ†å‘**ï¼šå°†é…ç½®ä¿¡æ¯åˆ†å‘ç»™å¤šä¸ªæœåŠ¡å®ä¾‹
- **å‚è€ƒæ•°æ®ç¼“å­˜**ï¼šç¼“å­˜å­—å…¸ã€æ˜ å°„è¡¨ç­‰å‚è€ƒæ•°æ®
- **æœç´¢ç»“æœç´¢å¼•**ï¼šå­˜å‚¨å’Œåˆ†å‘æœç´¢ç´¢å¼•æ•°æ®
- **åœ°ç†æ•°æ®**ï¼šåˆ†å‘åœ°ç†ä½ç½®ã€åŒºåŸŸä¿¡æ¯ç­‰æ•°æ®
- **ä¸šåŠ¡è§„åˆ™æ•°æ®**ï¼šåˆ†å‘ä¸šåŠ¡è§„åˆ™ã€ç­–ç•¥é…ç½®ç­‰

## Hollow æ ¸å¿ƒæ¶æ„

### ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "æ•°æ®ç”Ÿäº§è€…ç«¯"
        A[ä¸šåŠ¡ç³»ç»Ÿ] --> B[Hollow Producer]
        B --> C[æ•°æ®å¿«ç…§ç”Ÿæˆ]
        C --> D[å¢é‡æ›´æ–°ç”Ÿæˆ]
        D --> E[å‘å¸ƒç³»ç»Ÿ]
    end
    
    subgraph "æ•°æ®ä¼ è¾“å±‚"
        E --> F[Kafka/æ¶ˆæ¯é˜Ÿåˆ—]
        F --> G[S3/Blob Storage]
    end
    
    subgraph "æ•°æ®æ¶ˆè´¹è€…ç«¯"
        F --> H[Consumer åº”ç”¨1]
        G --> H
        F --> I[Consumer åº”ç”¨2]
        G --> I
        F --> J[Consumer åº”ç”¨N]
        G --> J
        
        H --> K[æœ¬åœ°å†…å­˜æ•°æ®é›†]
        I --> L[æœ¬åœ°å†…å­˜æ•°æ®é›†]
        J --> M[æœ¬åœ°å†…å­˜æ•°æ®é›†]
    end
    
    style B fill:#e1f5ff
    style E fill:#fff4e1
    style F fill:#ffe1f5
    style K fill:#e1ffe1
    style L fill:#e1ffe1
    style M fill:#e1ffe1
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

| ç»„ä»¶ | èŒè´£ | å…³é”®ç‰¹æ€§ |
|------|------|---------|
| **Hollow Producer** | ç”Ÿæˆæ•°æ®å¿«ç…§å’Œå¢é‡æ›´æ–° | æ•°æ®å»é‡ã€å‹ç¼©ã€ç‰ˆæœ¬ç®¡ç† |
| **å‘å¸ƒç³»ç»Ÿ** | ä¼ è¾“æ•°æ®å¿«ç…§å’Œå¢é‡ | Kafkaã€S3ã€æ–‡ä»¶ç³»ç»Ÿç­‰ |
| **Hollow Consumer** | æ¶ˆè´¹æ•°æ®å¹¶æ„å»ºæœ¬åœ°è§†å›¾ | å¢é‡æ›´æ–°åº”ç”¨ã€å†…å­˜ç®¡ç† |
| **æ•°æ®å¿«ç…§** | å®Œæ•´çš„æ•°æ®é›†çŠ¶æ€ | åˆå§‹åŠ è½½ã€æ¢å¤ç‚¹ |
| **å¢é‡æ›´æ–°** | æ•°æ®é›†çš„å˜åŒ– | å‡å°‘ä¼ è¾“é‡ã€å¿«é€Ÿæ›´æ–° |

## å¿«é€Ÿå…¥é—¨

### 1. æ·»åŠ ä¾èµ–

#### Maven

```xml
<dependency>
    <groupId>com.netflix.hollow</groupId>
    <artifactId>hollow</artifactId>
    <version>4.14.0</version>
</dependency>
```

#### Gradle

```gradle
implementation 'com.netflix.hollow:hollow:4.14.0'
```

### 2. å®šä¹‰æ•°æ®æ¨¡å‹

é¦–å…ˆéœ€è¦å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆPOJOsï¼‰ï¼Œä¾‹å¦‚ç”µå½±ä¿¡æ¯ï¼š

```java
public class Movie {
    private final int id;
    private final String title;
    private final int year;
    
    public Movie(int id, String title, int year) {
        this.id = id;
        this.title = title;
        this.year = year;
    }
    
    // Getters
    public int getId() { return id; }
    public String getTitle() { return title; }
    public int getYear() { return year; }
}
```

### 3. åˆ›å»ºæ•°æ®ç”Ÿäº§è€…

```java
import com.netflix.hollow.api.producer.HollowProducer;
import com.netflix.hollow.api.producer.fs.HollowFilesystemAnnouncer;
import com.netflix.hollow.api.producer.fs.HollowFilesystemPublisher;

public class MovieProducer {
    public static void main(String[] args) {
        // é…ç½®å‘å¸ƒå™¨å’Œé€šå‘Šå™¨
        HollowFilesystemPublisher publisher = 
            new HollowFilesystemPublisher("data");
        HollowFilesystemAnnouncer announcer = 
            new HollowFilesystemAnnouncer("data");
        
        // åˆ›å»ºç”Ÿäº§è€…
        HollowProducer producer = HollowProducer
            .withPublisher(publisher)
            .withAnnouncer(announcer)
            .build();
        
        // è¿è¡Œæ•°æ®å¾ªç¯
        producer.runCycle(state -> {
            // æ·»åŠ æ•°æ®
            state.add(new Movie(1, "Inception", 2010));
            state.add(new Movie(2, "Interstellar", 2014));
            state.add(new Movie(3, "The Matrix", 1999));
        });
    }
}
```

### 4. åˆ›å»ºæ•°æ®æ¶ˆè´¹è€…

```java
import com.netflix.hollow.api.consumer.HollowConsumer;
import com.netflix.hollow.api.consumer.fs.HollowFilesystemBlobRetriever;

public class MovieConsumer {
    private HollowConsumer.BlobRetriever blobRetriever;
    private HollowConsumer consumer;
    
    public void initialize() {
        // é…ç½® Blob æ£€ç´¢å™¨
        blobRetriever = new HollowFilesystemBlobRetriever("data");
        
        // åˆ›å»ºæ¶ˆè´¹è€…
        consumer = HollowConsumer
            .withBlobRetriever(blobRetriever)
            .build();
        
        // è§¦å‘åˆå§‹åŠ è½½
        consumer.triggerRefresh();
    }
    
    public void queryData() {
        // è·å–æ•°æ®è®¿é—®å™¨ï¼ˆéœ€è¦æ ¹æ®ç”Ÿæˆçš„æ•°æ®æ¨¡å‹ï¼‰
        // MovieAPI api = consumer.getAPI();
        // List<Movie> movies = api.getAllMovies();
    }
}
```

## æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### æ•°æ®æ¨¡å‹å®šä¹‰

Hollow ä½¿ç”¨ POJO å®šä¹‰æ•°æ®æ¨¡å‹ï¼Œä½†éœ€è¦æ»¡è¶³ä¸€äº›çº¦æŸï¼š

```mermaid
graph LR
    A[POJO ç±»] --> B[ä¸å¯å˜å¯¹è±¡]
    A --> C[equals/hashCode]
    A --> D[æ— å¾ªç¯å¼•ç”¨]
    A --> E[å¯åºåˆ—åŒ–]
    
    B --> F[final å­—æ®µ]
    B --> G[æ„é€ å‡½æ•°åˆå§‹åŒ–]
```

**POJO çº¦æŸï¼š**

1. **ä¸å¯å˜å¯¹è±¡**ï¼šæ‰€æœ‰å­—æ®µåº”è¯¥æ˜¯ `final`ï¼Œé€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–
2. **å®ç° equals å’Œ hashCode**ï¼šç”¨äºå»é‡
3. **é¿å…å¾ªç¯å¼•ç”¨**ï¼šHollow ä¸æ”¯æŒå¾ªç¯å¼•ç”¨
4. **å¯åºåˆ—åŒ–**ï¼šå¯¹è±¡éœ€è¦èƒ½å¤Ÿåºåˆ—åŒ–

### ç”Ÿäº§è€…å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant App as åº”ç”¨ç¨‹åº
    participant Producer as Hollow Producer
    participant State as Write State
    participant Publisher as Publisher
    
    App->>Producer: runCycle(callback)
    Producer->>State: åˆ›å»º Write State
    Producer->>State: è°ƒç”¨ callback æ·»åŠ æ•°æ®
    State->>State: å»é‡å¤„ç†
    Producer->>State: å®Œæˆæ•°æ®æ·»åŠ 
    Producer->>State: ç”Ÿæˆæ•°æ®å¿«ç…§
    Producer->>State: ç”Ÿæˆå¢é‡æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰
    Producer->>Publisher: å‘å¸ƒå¿«ç…§/å¢é‡
    Publisher->>App: å‘å¸ƒå®Œæˆ
```

### æ¶ˆè´¹è€…å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant Consumer as Hollow Consumer
    participant BlobRetriever as Blob Retriever
    participant Memory as å†…å­˜æ•°æ®é›†
    participant App as åº”ç”¨ç¨‹åº
    
    App->>Consumer: triggerRefresh()
    Consumer->>BlobRetriever: è·å–æœ€æ–°ç‰ˆæœ¬
    BlobRetriever-->>Consumer: è¿”å›ç‰ˆæœ¬ä¿¡æ¯
    Consumer->>BlobRetriever: è·å–æ•°æ® Blob
    BlobRetriever-->>Consumer: è¿”å› Blob æ•°æ®
    Consumer->>Memory: åŠ è½½/æ›´æ–°æ•°æ®
    Memory->>Memory: åº”ç”¨å¢é‡æ›´æ–°
    Memory-->>Consumer: æ•°æ®å°±ç»ª
    Consumer->>App: æä¾›æ•°æ®è®¿é—® API
    App->>Memory: æŸ¥è¯¢æ•°æ®
    Memory-->>App: è¿”å›ç»“æœ
```

### æ•°æ®ç‰ˆæœ¬ç®¡ç†

```mermaid
graph TB
    A[ç‰ˆæœ¬ 1<br/>åˆå§‹å¿«ç…§] --> B[ç‰ˆæœ¬ 2<br/>å¢é‡æ›´æ–°]
    B --> C[ç‰ˆæœ¬ 3<br/>å¢é‡æ›´æ–°]
    C --> D[ç‰ˆæœ¬ 4<br/>å¢é‡æ›´æ–°]
    D --> E[ç‰ˆæœ¬ 5<br/>å®Œæ•´å¿«ç…§]
    E --> F[ç‰ˆæœ¬ 6<br/>å¢é‡æ›´æ–°]
    
    style A fill:#e1f5ff
    style E fill:#e1f5ff
```

**ç‰ˆæœ¬ç®¡ç†ç­–ç•¥ï¼š**

- **åˆå§‹å¿«ç…§**ï¼šé¦–æ¬¡å‘å¸ƒå®Œæ•´æ•°æ®é›†
- **å¢é‡æ›´æ–°**ï¼šåç»­ç‰ˆæœ¬åªåŒ…å«å˜åŒ–éƒ¨åˆ†
- **å®šæœŸå¿«ç…§**ï¼šæ¯éš” N ä¸ªç‰ˆæœ¬å‘å¸ƒå®Œæ•´å¿«ç…§ï¼Œä¾¿äºæ¢å¤å’Œä¼˜åŒ–

### å†…å­˜ç»“æ„

```mermaid
graph TB
    subgraph "Hollow å†…å­˜ç»“æ„"
        A[æ ¹æ•°æ®] --> B[å­—ç¬¦ä¸²æ± ]
        A --> C[æ•´æ•°æ± ]
        A --> D[å¼•ç”¨ç´¢å¼•]
        
        B --> E[å»é‡å­—ç¬¦ä¸²]
        C --> F[å»é‡æ•´æ•°]
        D --> G[å¯¹è±¡å¼•ç”¨]
        
        G --> H[å¯¹è±¡æ•°æ®]
    end
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#fff4e1
    style D fill:#ffe1f5
```

**å†…å­˜ä¼˜åŒ–æŠ€æœ¯ï¼š**

1. **å­—ç¬¦ä¸²å»é‡**ï¼šç›¸åŒçš„å­—ç¬¦ä¸²åªå­˜å‚¨ä¸€æ¬¡
2. **æ•´æ•°æ± åŒ–**ï¼šå°çš„æ•´æ•°å€¼ä½¿ç”¨æ± åŒ–æŠ€æœ¯
3. **å¼•ç”¨å…±äº«**ï¼šç›¸åŒçš„å¯¹è±¡å¼•ç”¨å…±äº«å­˜å‚¨
4. **å‹ç¼©ç¼–ç **ï¼šä½¿ç”¨é«˜æ•ˆçš„ç¼–ç æ–¹å¼å­˜å‚¨æ•°æ®

## é«˜çº§ç‰¹æ€§

### 1. ä½¿ç”¨ Kafka å‘å¸ƒæ•°æ®

```java
import com.netflix.hollow.api.producer.HollowProducer;
import com.netflix.hollow.api.producer.HollowProducer.Publisher;

public class KafkaHollowProducer {
    public static void main(String[] args) {
        // è‡ªå®šä¹‰ Kafka Publisher
        Publisher publisher = new Publisher() {
            @Override
            public void publish(HollowProducer.Blob blob) {
                // å‘å¸ƒåˆ° Kafka
                // kafkaProducer.send(topic, blob.getBytes());
            }
        };
        
        HollowProducer producer = HollowProducer
            .withPublisher(publisher)
            .build();
        
        producer.runCycle(state -> {
            // æ·»åŠ æ•°æ®
        });
    }
}
```

### 2. è‡ªå®šä¹‰ç›‘å¬å™¨

```java
import com.netflix.hollow.api.consumer.HollowConsumer;

public class MovieConsumerWithListener {
    public void initialize() {
        HollowConsumer consumer = HollowConsumer
            .withBlobRetriever(blobRetriever)
            .withRefreshListener(new HollowConsumer.RefreshListener() {
                @Override
                public void refreshStarted(long currentVersion, long requestedVersion) {
                    System.out.println("åˆ·æ–°å¼€å§‹: " + currentVersion + " -> " + requestedVersion);
                }
                
                @Override
                public void refreshCompleted(long currentVersion, long requestedVersion) {
                    System.out.println("åˆ·æ–°å®Œæˆ: " + currentVersion);
                }
                
                @Override
                public void refreshFailed(long currentVersion, long requestedVersion, 
                                         Throwable cause) {
                    System.err.println("åˆ·æ–°å¤±è´¥: " + cause.getMessage());
                }
            })
            .build();
    }
}
```

### 3. æ•°æ®æŸ¥è¯¢ API

Hollow ä¼šä¸ºä½ çš„ POJO è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢ APIã€‚å¯¹äº `Movie` ç±»ï¼Œä¼šç”Ÿæˆ `MovieAPI`ï¼š

```mermaid
graph LR
    A[Movie POJO] --> B[ä»£ç ç”Ÿæˆ]
    B --> C[MovieAPI]
    C --> D[æŸ¥è¯¢æ–¹æ³•]
    
    D --> E[getAllMovies]
    D --> F[findMovieById]
    D --> G[findMoviesByYear]
    D --> H[iterateMovies]
```

**ç”Ÿæˆçš„ API ç¤ºä¾‹ï¼š**

```java
// å‡è®¾ç”Ÿæˆçš„ APIï¼ˆå®é™…ä½¿ç”¨éœ€è¦ä»£ç ç”Ÿæˆï¼‰
MovieAPI api = consumer.getAPI();

// è·å–æ‰€æœ‰ç”µå½±
List<Movie> allMovies = api.getAllMovies();

// æ ¹æ® ID æŸ¥æ‰¾
Movie movie = api.findMovieById(1);

// éå†æ‰€æœ‰ç”µå½±
for (Movie movie : api) {
    System.out.println(movie.getTitle());
}
```

### 4. ç´¢å¼•å’Œè¿‡æ»¤

```mermaid
graph TB
    A[åŸå§‹æ•°æ®] --> B[åˆ›å»ºç´¢å¼•]
    B --> C[å“ˆå¸Œç´¢å¼•]
    B --> D[æ’åºç´¢å¼•]
    
    C --> E[å¿«é€ŸæŸ¥æ‰¾]
    D --> F[èŒƒå›´æŸ¥è¯¢]
    
    E --> G[æŒ‰ ID æŸ¥æ‰¾]
    F --> H[æŒ‰å¹´ä»½èŒƒå›´æŸ¥è¯¢]
```

**ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹ï¼š**

```java
// ä¸ºå¹´ä»½å­—æ®µåˆ›å»ºç´¢å¼•
HollowProducer producer = HollowProducer
    .withPublisher(publisher)
    .withIndexListener((api, removedTypes, addedTypes) -> {
        // åˆ›å»ºè‡ªå®šä¹‰ç´¢å¼•
        // api.buildIndex("year", movie -> movie.getYear());
    })
    .build();
```

## æœ€ä½³å®è·µ

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

```mermaid
graph TB
    A[æ•°æ®æ¨¡å‹è®¾è®¡] --> B[ä¿æŒç®€å•]
    A --> C[é¿å…åµŒå¥—è¿‡æ·±]
    A --> D[ä½¿ç”¨æ‰å¹³ç»“æ„]
    A --> E[æ˜ç¡®å­—æ®µç±»å‹]
    
    B --> F[å‡å°‘å¯¹è±¡æ•°é‡]
    C --> G[æé«˜æŸ¥è¯¢æ•ˆç‡]
    D --> H[ä¼˜åŒ–å†…å­˜ä½¿ç”¨]
    E --> I[ç±»å‹å®‰å…¨]
```

**è®¾è®¡å»ºè®®ï¼š**

- âœ… **ä¿æŒç®€å•**ï¼šé¿å…å¤æ‚çš„åµŒå¥—ç»“æ„
- âœ… **æ‰å¹³åŒ–**ï¼šå°½é‡ä½¿ç”¨æ‰å¹³çš„æ•°æ®ç»“æ„
- âœ… **ç±»å‹æ˜ç¡®**ï¼šä½¿ç”¨æ˜ç¡®çš„ç±»å‹ï¼Œé¿å…æ³›å‹
- âŒ **é¿å…å¾ªç¯å¼•ç”¨**ï¼šHollow ä¸æ”¯æŒå¾ªç¯å¼•ç”¨
- âŒ **é¿å…å¯å˜å¯¹è±¡**ï¼šåªä½¿ç”¨ä¸å¯å˜å¯¹è±¡

### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®

```mermaid
flowchart TD
    A[ç”Ÿäº§ç¯å¢ƒé…ç½®] --> B[ç‰ˆæœ¬ç®¡ç†ç­–ç•¥]
    A --> C[å‘å¸ƒé¢‘ç‡]
    A --> D[ç›‘æ§å‘Šè­¦]
    A --> E[é”™è¯¯å¤„ç†]
    
    B --> F[å®šæœŸå®Œæ•´å¿«ç…§]
    B --> G[å¢é‡æ›´æ–°é¢‘ç‡]
    
    C --> H[æ ¹æ®æ•°æ®å˜åŒ–é¢‘ç‡è°ƒæ•´]
    
    D --> I[ç‰ˆæœ¬å·ç›‘æ§]
    D --> J[å†…å­˜ä½¿ç”¨ç›‘æ§]
    
    E --> K[é‡è¯•æœºåˆ¶]
    E --> L[é™çº§ç­–ç•¥]
```

**é…ç½®è¦ç‚¹ï¼š**

1. **ç‰ˆæœ¬ç®¡ç†**ï¼š
   - æ¯ 10-20 ä¸ªå¢é‡æ›´æ–°åå‘å¸ƒä¸€æ¬¡å®Œæ•´å¿«ç…§
   - ä¿ç•™æœ€è¿‘ N ä¸ªç‰ˆæœ¬ç”¨äºå›æ»š

2. **å‘å¸ƒé¢‘ç‡**ï¼š
   - æ ¹æ®æ•°æ®å˜åŒ–é¢‘ç‡è°ƒæ•´
   - é¿å…è¿‡äºé¢‘ç¹çš„æ›´æ–°

3. **ç›‘æ§æŒ‡æ ‡**ï¼š
   - æ•°æ®ç‰ˆæœ¬å·
   - å†…å­˜ä½¿ç”¨æƒ…å†µ
   - æ›´æ–°æˆåŠŸ/å¤±è´¥ç‡
   - æ¶ˆè´¹è€…å»¶è¿Ÿ

### 3. æ€§èƒ½ä¼˜åŒ–

```mermaid
graph LR
    A[æ€§èƒ½ä¼˜åŒ–] --> B[å†…å­˜ä¼˜åŒ–]
    A --> C[æŸ¥è¯¢ä¼˜åŒ–]
    A --> D[æ›´æ–°ä¼˜åŒ–]
    
    B --> E[å‡å°‘å¯¹è±¡æ•°é‡]
    B --> F[å­—ç¬¦ä¸²å»é‡]
    
    C --> G[ä½¿ç”¨ç´¢å¼•]
    C --> H[æ‰¹é‡æŸ¥è¯¢]
    
    D --> I[å¢é‡æ›´æ–°]
    D --> J[å¼‚æ­¥åŠ è½½]
```

**ä¼˜åŒ–æŠ€å·§ï¼š**

1. **å†…å­˜ä¼˜åŒ–**ï¼š
   ```java
   // ä½¿ç”¨åŸå§‹ç±»å‹è€ŒéåŒ…è£…ç±»å‹
   private final int id;        // âœ… æ¨è
   private final Integer id;    // âŒ ä¸æ¨è
   ```

2. **æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   ```java
   // æ‰¹é‡æŸ¥è¯¢è€Œéå¾ªç¯æŸ¥è¯¢
   List<Movie> movies = api.findMoviesByIds(idList);  // âœ…
   for (int id : idList) {
       api.findMovieById(id);  // âŒ æ€§èƒ½å·®
   }
   ```

3. **æ›´æ–°ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨å¢é‡æ›´æ–°è€Œéå®Œæ•´å¿«ç…§
   - å¼‚æ­¥åŠ è½½æ•°æ®ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹

### 4. é”™è¯¯å¤„ç†å’Œæ¢å¤

```mermaid
sequenceDiagram
    participant Consumer as Consumer
    participant Retriever as Blob Retriever
    participant Fallback as é™çº§ç­–ç•¥
    
    Consumer->>Retriever: è·å–æ•°æ®
    Retriever-->>Consumer: å¤±è´¥
    Consumer->>Fallback: ä½¿ç”¨æ—§ç‰ˆæœ¬æ•°æ®
    Consumer->>Retriever: é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
    Retriever-->>Consumer: æˆåŠŸ
    Consumer->>Consumer: æ›´æ–°æ•°æ®
```

**é”™è¯¯å¤„ç†ç­–ç•¥ï¼š**

```java
HollowConsumer consumer = HollowConsumer
    .withBlobRetriever(blobRetriever)
    .withRefreshListener(new HollowConsumer.RefreshListener() {
        @Override
        public void refreshFailed(long currentVersion, long requestedVersion, 
                                 Throwable cause) {
            // è®°å½•é”™è¯¯
            logger.error("æ•°æ®åˆ·æ–°å¤±è´¥", cause);
            
            // ä½¿ç”¨æ—§ç‰ˆæœ¬æ•°æ®æˆ–é™çº§ç­–ç•¥
            // fallbackToStaleData();
            
            // è°ƒåº¦é‡è¯•
            // scheduleRetry(requestedVersion);
        }
    })
    .build();
```

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šé…ç½®æ•°æ®åˆ†å‘

```mermaid
graph TB
    A[é…ç½®ç®¡ç†ç³»ç»Ÿ] --> B[Hollow Producer]
    B --> C[å‘å¸ƒé…ç½®æ•°æ®]
    C --> D[å¤šä¸ªæœåŠ¡å®ä¾‹]
    
    D --> E[æœåŠ¡å®ä¾‹ 1]
    D --> F[æœåŠ¡å®ä¾‹ 2]
    D --> G[æœåŠ¡å®ä¾‹ N]
    
    E --> H[æœ¬åœ°å†…å­˜é…ç½®]
    F --> I[æœ¬åœ°å†…å­˜é…ç½®]
    G --> J[æœ¬åœ°å†…å­˜é…ç½®]
```

**å®ç°ç¤ºä¾‹ï¼š**

```java
// é…ç½®æ•°æ®æ¨¡å‹
public class ServiceConfig {
    private final String serviceName;
    private final Map<String, String> properties;
    
    // ... æ„é€ å‡½æ•°å’Œ getters
}

// ç”Ÿäº§è€…
producer.runCycle(state -> {
    List<ServiceConfig> configs = loadConfigsFromDatabase();
    configs.forEach(state::add);
});

// æ¶ˆè´¹è€…
ServiceConfigAPI api = consumer.getAPI();
ServiceConfig config = api.getConfigByServiceName("my-service");
```

### åœºæ™¯ 2ï¼šæœç´¢ç»“æœç´¢å¼•

```mermaid
graph LR
    A[å†…å®¹ç³»ç»Ÿ] --> B[æ„å»ºç´¢å¼•]
    B --> C[Hollow Producer]
    C --> D[å‘å¸ƒç´¢å¼•]
    D --> E[æœç´¢æœåŠ¡]
    E --> F[æœ¬åœ°ç´¢å¼•æŸ¥è¯¢]
    F --> G[å¿«é€Ÿè¿”å›ç»“æœ]
```

### åœºæ™¯ 3ï¼šåœ°ç†æ•°æ®åˆ†å‘

```mermaid
graph TB
    A[åœ°ç†æ•°æ®æº] --> B[æ•°æ®è½¬æ¢]
    B --> C[Hollow Producer]
    C --> D[å‘å¸ƒåœ°ç†æ•°æ®]
    D --> E[å¤šä¸ªæœåŠ¡]
    
    E --> F[è®¢å•æœåŠ¡<br/>åœ°å€éªŒè¯]
    E --> G[é…é€æœåŠ¡<br/>è·¯çº¿è§„åˆ’]
    E --> H[åˆ†ææœåŠ¡<br/>åŒºåŸŸç»Ÿè®¡]
```

## ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

### Hollow vs Redis

```mermaid
graph TB
    subgraph "Hollow"
        A1[å†…å­˜å­˜å‚¨]
        A2[åªè¯»æ•°æ®é›†]
        A3[é«˜æ•ˆå»é‡]
        A4[å¢é‡æ›´æ–°]
    end
    
    subgraph "Redis"
        B1[å†…å­˜å­˜å‚¨]
        B2[è¯»å†™æ”¯æŒ]
        B3[æ•°æ®ç»“æ„ä¸°å¯Œ]
        B4[ç½‘ç»œè®¿é—®]
    end
    
    style A1 fill:#e1f5ff
    style B1 fill:#fff4e1
```

| ç‰¹æ€§ | Hollow | Redis |
|------|--------|-------|
| **è®¿é—®æ–¹å¼** | æœ¬åœ°å†…å­˜ï¼Œé›¶ç½‘ç»œå»¶è¿Ÿ | ç½‘ç»œè®¿é—® |
| **æ•°æ®å¤§å°** | æ”¯æŒæ•°GBæ•°æ®é›† | å—å†…å­˜é™åˆ¶ |
| **æ›´æ–°æ–¹å¼** | å¢é‡æ›´æ–°ï¼Œé«˜æ•ˆ | éœ€è¦åŒæ­¥æ›´æ–° |
| **è¯»å†™èƒ½åŠ›** | åªè¯» | è¯»å†™ |
| **ä½¿ç”¨åœºæ™¯** | å¤§è§„æ¨¡åªè¯»æ•°æ®é›† | é”®å€¼ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ |

### Hollow vs æ•°æ®åº“æŸ¥è¯¢

```mermaid
graph LR
    A[ä¼ ç»Ÿæ–¹æ¡ˆ] --> B[æ¯æ¬¡æŸ¥è¯¢æ•°æ®åº“]
    B --> C[ç½‘ç»œå»¶è¿Ÿ]
    B --> D[æ•°æ®åº“è´Ÿè½½]
    
    E[Hollowæ–¹æ¡ˆ] --> F[æœ¬åœ°å†…å­˜æŸ¥è¯¢]
    F --> G[é›¶å»¶è¿Ÿ]
    F --> H[æ— æ•°æ®åº“è´Ÿè½½]
    
    style C fill:#ffe1e1
    style D fill:#ffe1e1
    style G fill:#e1ffe1
    style H fill:#e1ffe1
```

## å¸¸è§é—®é¢˜è§£ç­”

### Q1: Hollow é€‚ç”¨äºå“ªäº›æ•°æ®ç±»å‹ï¼Ÿ

**A:** Hollow æœ€é€‚åˆï¼š
- âœ… å‚è€ƒæ•°æ®ï¼ˆå­—å…¸ã€æ˜ å°„è¡¨ï¼‰
- âœ… é…ç½®æ•°æ®
- âœ… æœç´¢ç´¢å¼•
- âœ… åªè¯»æ•°æ®é›†
- âŒ ä¸é€‚åˆé¢‘ç¹æ›´æ–°çš„å†™å¯†é›†å‹æ•°æ®
- âŒ ä¸é€‚åˆéœ€è¦äº‹åŠ¡æ”¯æŒçš„æ•°æ®

### Q2: å¦‚ä½•å¤„ç†æ•°æ®æ›´æ–°å¤±è´¥ï¼Ÿ

**A:** å»ºè®®å®ç°ä»¥ä¸‹æœºåˆ¶ï¼š

```mermaid
flowchart TD
    A[æ›´æ–°å¤±è´¥] --> B{æ˜¯å¦æœ‰æ—§ç‰ˆæœ¬?}
    B -->|æ˜¯| C[ä½¿ç”¨æ—§ç‰ˆæœ¬ç»§ç»­è¿è¡Œ]
    B -->|å¦| D[åº”ç”¨é™çº§ç­–ç•¥]
    C --> E[è®°å½•é”™è¯¯æ—¥å¿—]
    D --> E
    E --> F[è°ƒåº¦é‡è¯•]
    F --> G[æŒ‡æ•°é€€é¿]
    G --> H[é‡æ–°å°è¯•æ›´æ–°]
```

### Q3: Hollow çš„å†…å­˜å ç”¨å¦‚ä½•ï¼Ÿ

**A:** Hollow é€šè¿‡ä»¥ä¸‹æŠ€æœ¯ä¼˜åŒ–å†…å­˜ï¼š

```mermaid
graph TB
    A[åŸå§‹æ•°æ®] --> B[å»é‡å¤„ç†]
    B --> C[å­—ç¬¦ä¸²æ± ]
    B --> D[æ•´æ•°æ± ]
    B --> E[å¼•ç”¨å…±äº«]
    C --> F[å‹ç¼©æ•°æ®]
    D --> F
    E --> F
    F --> G[ä¼˜åŒ–åæ•°æ®<br/>é€šå¸¸å‡å°‘50-80%]
```

### Q4: å¦‚ä½•ç›‘æ§ Hollow çš„ä½¿ç”¨æƒ…å†µï¼Ÿ

**A:** å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

```mermaid
graph LR
    A[ç›‘æ§æŒ‡æ ‡] --> B[æ•°æ®ç‰ˆæœ¬]
    A --> C[å†…å­˜ä½¿ç”¨]
    A --> D[æ›´æ–°é¢‘ç‡]
    A --> E[æŸ¥è¯¢æ€§èƒ½]
    A --> F[é”™è¯¯ç‡]
    
    B --> G[ç‰ˆæœ¬å»¶è¿Ÿ]
    C --> H[å†…å­˜å ç”¨è¶‹åŠ¿]
    D --> I[æ›´æ–°æˆåŠŸç‡]
    E --> J[æŸ¥è¯¢å»¶è¿Ÿ]
    F --> K[é”™è¯¯ç±»å‹ç»Ÿè®¡]
```

## æ€»ç»“

Netflix Hollow æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å†…å­˜æ•°æ®é›†åˆ†å‘å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½è¯»å–å’Œå¤§è§„æ¨¡æ•°æ®åˆ†å‘çš„åœºæ™¯ã€‚é€šè¿‡åˆç†çš„è®¾è®¡å’Œä½¿ç”¨ï¼Œå¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚

### æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **æ¶æ„è®¾è®¡**ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæ”¯æŒåˆ†å¸ƒå¼æ•°æ®åˆ†å‘
2. **å†…å­˜ä¼˜åŒ–**ï¼šå»é‡ã€å‹ç¼©ç­‰æŠ€æœ¯å¤§å¹…å‡å°‘å†…å­˜å ç”¨
3. **å¢é‡æ›´æ–°**ï¼šæ”¯æŒé«˜æ•ˆçš„å¢é‡æ›´æ–°æœºåˆ¶
4. **æ˜“äºä½¿ç”¨**ï¼šç®€å•çš„ APIï¼Œæ˜“äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

- ğŸ“– é˜…è¯» [Hollow å®˜æ–¹æ–‡æ¡£](https://hollow.how/)
- ğŸ’» å°è¯• [Hollow ç¤ºä¾‹ä»£ç ](https://github.com/Netflix/hollow)
- ğŸš€ åœ¨é¡¹ç›®ä¸­é›†æˆ Hollow
- ğŸ“Š ç›‘æ§å’Œä¼˜åŒ– Hollow ä½¿ç”¨æ•ˆæœ

---

**å‚è€ƒèµ„æºï¼š**

- [GitHub ä»“åº“](https://github.com/Netflix/hollow)
- [å®˜æ–¹æ–‡æ¡£](https://hollow.how/)
- [å¿«é€Ÿå…¥é—¨æŒ‡å—](https://hollow.how/quick-start/)
- [DeepWiki é¡µé¢](https://deepwiki.com/Netflix/hollow)

